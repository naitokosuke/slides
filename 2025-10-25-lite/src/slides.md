---
theme: default
transition: slide-left
title: æœ€é«˜ã® DX (lite) - Nuxt Typed Router ã¨ Pinia Colada ã§å®Ÿç¾ã™ã‚‹æ¬¡ä¸–ä»£ Vue/Nuxt é–‹ç™º
fonts:
  sans: "Noto Sans JP"
  serif: "Murecho"
  mono: "JetBrains Mono"
seoMeta:
  ogTitle: æœ€é«˜ã® DX (lite) - Nuxt Typed Router ã¨ Pinia Colada ã§å®Ÿç¾ã™ã‚‹æ¬¡ä¸–ä»£ Vue/Nuxt é–‹ç™º
  ogImage: https://slides.naito.dev/2025-10-25-lite/og-image.png
  ogUrl: https://slides.naito.dev/2025-10-25-lite/
  twitterCard: summary_large_image
---

# æœ€é«˜ã® DX (lite) - Nuxt Typed Router ã¨ Pinia Colada ã§å®Ÿç¾ã™ã‚‹æ¬¡ä¸–ä»£ Vue/Nuxt é–‹ç™º

---

## Twitter Share

ç™ºè¡¨ä¸­ã€ã‚‚ã—ã‚ˆã‚ã—ã‘ã‚Œã°ãƒ„ã‚¤ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚

---

## è‡ªå·±ç´¹ä»‹

![ãƒŠã‚¤ãƒˆã‚¦ã‚³ã‚¦ã‚¹ã‚±](/naitokosuke-sns-icon.png)

**ãƒŠã‚¤ãƒˆã‚¦ã‚³ã‚¦ã‚¹ã‚±**

Composition API ç”Ÿã¾ã‚Œ
script setup è‚²ã¡

---

## æ ªå¼ä¼šç¤¾ãƒ¡ã‚¤ãƒ„

**æ ªå¼ä¼šç¤¾ãƒ¡ã‚¤ãƒ„**

- EdTech ä¼æ¥­
- Web ã‚¢ãƒ—ãƒª
- Vue / Nuxt

---

![æ ªå¼ä¼šç¤¾ãƒ¡ã‚¤ãƒ„](/mates-logo.png)

---

## ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«é¢è«‡

---

![Wantedly](/wantedly.png)

---

## ã‚¯ã‚¤ã‚º ãªã‚“ã®æ•°å­—ï¼Ÿ

---
layout: center
class: text-8xl
---

**57** **44** **54**


<br />

**35** **42**

---

![Vue Fes Japan 2025](/vue-fes-japan-2025.png)

---

## Vue Fes Japan 2025 ã«é–¢ã‚ã‚‹æ•°

| ã‚¹ãƒãƒ³ã‚µãƒ¼ä¼æ¥­ | å€‹äººã‚¹ãƒãƒ³ã‚µãƒ¼ | ã‚¹ã‚¿ãƒƒãƒ• |
| :------------: | :------------: | :------: |
|     **57**     |     **44**     |  **54**  |

| ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ | ç™»å£‡è€… |
| :----------: | :----: |
|    **35**    | **42** |

â€» https://vuefes.jp/2025/sponsors
â€» åŒã˜äººã‚’ã‚ã£ã¡ã‚ƒé‡è¤‡ã—ã¦æ•°ãˆã¦ã„ã‚‹
â€» ã–ã£ãã‚Šæ•°ãˆ

---
layout: center
class: text-9xl
---

æ„Ÿè¬

---
layout: center
class: text-9xl
---

<logos-vue /> <logos-nuxt-icon />

---
layout: center
class: text-9xl
---

<logos-react /> <logos-nextjs-icon />

---
layout: center
class: text-9xl
---

<logos-angular-icon />

---
layout: center
class: text-9xl
---

<logos-svelte-icon />

---
layout: center
class: text-9xl
---

<logos-solidjs-icon />

---
layout: center
class: text-9xl
---

<logos-qwik-icon />

---
layout: center
class: text-9xl
---

<logos-astro-icon />

---
layout: center
class: text-9xl
---

<logos-preact />

---

## æ‡‡è¦ªä¼šã®è©±ã®ã‚¿ãƒã«

æ‡‡è¦ªä¼šã®è©±ã®ã‚¿ãƒã«ãªã‚Œã°å¬‰ã—ã„ã§ã™

- ã€ŒãƒŠã‚¤ãƒˆã‚¦ã®ç™ºè¡¨è¦‹ã¾ã—ãŸï¼ã€
- ã€ŒPinia Colada ã£ã¦...ã€
- ã€Œãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã£ã¦ã©ã†ã—ã¦ã¾ã™ã‹ï¼Ÿã€
- ã€ŒNuxt Typed Router ã£ã¦è‰¯ã•ãã†ã§ã™ã­ï¼ã€
- ã€ŒReact / Next.js ã§ã¯ã©ã‚“ãªæ„Ÿã˜ï¼Ÿã€

---
layout: center
class: text-9xl
---

ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 

---
layout: center
class: text-9xl
---

Vue ã®æœªæ¥

---

## "The limits of my language mean the limits of my world."

ã€Œäººé–“ã¯ã€ã„ã¾è‡ªåˆ†ãŒè©±ã—ã¦ã„ã‚‹è¨€è‘‰ã®ç¯„å›²ã§ã—ã‹ã€ä¸–ç•Œã‚’è€ƒãˆã‚‹ã“ã¨ãŒã§ããªã„ã€‚ã€

â€” Ludwig Wittgenstein, 1922

ãŸã¾ã«ã¯å¤–ã®ä¸–ç•Œã«å‡ºã¦çŸ¥ã‚‰ãªã„äººã®è©±ã‚’èã“ã†ï¼

---

ã€Œã©ã†ã›æŠ€è¡“çš„è² å‚µã«ãªã‚‹ã‹ã‚‰ã€
ã£ã¦ã„ã†ã®ã¯è¨­è¨ˆã¨ã‹å®Ÿè£…ã¨ã‹
ä¸Šæ‰‹ããªã‚‹æ©Ÿä¼šã‚’é€ƒã—ã¦ã„ã‚‹

---

![lacolaco ã•ã‚“ TS Kaigi 2025](/lacolaco-tskaigi.png)

---

ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è©±ã‹ãªã€
ã£ã¦æ€ã£ã¡ã‚ƒã†ã‘ã©ã€
æŠ½è±¡åŒ–ã™ã‚Œã°æŠ½è±¡çš„ã«è¦‹ã‚Œã°
ãã®è¨€èªãŒã©ã®ã‚ˆã†ãªèª²é¡Œã‚’æœ‰ã—ã¦ã„ã‚‹ã‹ã‚ã‹ã‚‹

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¦‹ã‚‹ã“ã¨ã§
è¨€èªã®æœªæ¥ã‚’
æƒ³åƒã™ã‚‹ã“ã¨ãŒã§ãã‚‹

https://youtu.be/OUsXjtkLYu0

---
layout: center
class: text-9xl
---

ã¨ã„ã†ã“ã¨ã§

---

## ã‚¿ã‚¤ãƒˆãƒ«å†è¡¨ç¤º

æœ€é«˜ã® DX - Nuxt Typed Router ã¨ Pinia Colada ã§å®Ÿç¾ã™ã‚‹æ¬¡ä¸–ä»£ Vue/Nuxt é–‹ç™º

ã€Œæœ€é«˜ã®ã€ã¨ã„ã†è¡¨ç¾ã¯ä¸»è¦³çš„ã§èª‡å¼µçš„ã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ã‚ˆã‚Šå®¢è¦³çš„ãªè©•ä¾¡ã‚’ç¤ºã™ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
(ai-writing/no-ai-hype-expressions)

---
layout: center
class: text-9xl
---

DX

---

## Developer Experience = é–‹ç™ºè€…ä½“é¨“

é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹å…¨ä½“ã§
é–‹ç™ºè€…ãŒæ„Ÿã˜ã‚‹ä½“é¨“ã®ç·ä½“

DX = ãªã‚“ã‹ã„ã„ãª

---

## æœ€é«˜ã® DX

é–‹ç™ºè€…ã®èªçŸ¥è² è·ã‚’æœ€å°åŒ–
æœ¬è³ªçš„ãªå•é¡Œè§£æ±ºã«é›†ä¸­

---
layout: center
class: text-9xl
---

èª²é¡Œ

---
layout: center
class: text-9xl
---

é–‹ç™ºã£ã¦å¤§å¤‰

---

## Web ã‚¢ãƒ—ãƒªé–‹ç™º(ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)

- **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ**
- **ãƒ•ã‚©ãƒ¼ãƒ **
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
- **èªè¨¼ãƒ»èªå¯**
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
- **çŠ¶æ…‹ç®¡ç†**
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**
- **å›½éš›åŒ–(i18n)**
- **ãƒ†ã‚¹ãƒˆ**
- **SEO å¯¾ç­–**
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
- **UI/UX**
- **ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤**
- **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**

ç‰¹ã«å¤§å¤‰ã˜ã‚ƒãªã„ã§ã™ã‹ï¼Ÿ
ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ

---
layout: center
class: text-7xl
---

åˆ‡ã£ã¦ã‚‚åˆ‡ã‚Œãªã„

---
layout: center
class: text-9xl
---

ã®ã«

---

## ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æ‰‹æ‰“ã¡(TS ä½¿ã£ã¦ã‚‹ã®ã«)

```ts
router.push(`/user/${userId}`);
router.push("/user/profile");
router.push("/user/settings");
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆ

```ts
const question = ref("");
const answer = ref("Questions usually contain a question mark. ;-)");
const loading = ref(false);

watch(question, async (newQuestion, oldQuestion) => {
  if (newQuestion.includes("?")) {
    loading.value = true;
    answer.value = "Thinking...";
    try {
      const res = await fetch("https://yesno.wtf/api");
      answer.value = (await res.json()).answer;
    } catch (error) {
      answer.value = "Error! Could not reach the API. " + error;
    } finally {
      loading.value = false;
    }
  }
});
```

from https://vuejs.org/guide/essentials/watchers

---

## Nuxt Typed Router ã¨ Pinia Colada

å‹å®‰å…¨ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
å®£è¨€çš„ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°

---
layout: center
class: text-9xl
---

ã©ã“ã§
<br />
<br />
<br />
<br />
<br />
å‡ºä¼šã£ãŸã‹

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

<div class="text-9xl text-center">
<logos-nuxt-icon /> <logos-graphql /> <logos-pinia />
</div>

<br />

<div class="flex justify-center"><img src="/icons/nuxt-typed-router.svg" class="inline-block h-60" /> <img src="/icons/pinia-colada.svg" class="inline-block h-60" /></div>

---
layout: center
---

## Nuxt Typed Router

![Nuxt Typed Router](/icons/nuxt-typed-router.svg)

---

## å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

https://nuxt-typed-router.vercel.app/

---

## Nuxt Typed Router ã¨ã¯

å‹å®‰å…¨ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
Nuxt ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

---

## nuxt-typed-router

![Victor Garcia GitHub](/victorgarciaesgi-github.png)

by victorgarciaesgi
Victor Garcia

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã‹ã‚‰è‡ªå‹•å‹ç”Ÿæˆ

Nuxt ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```
pages/
  index.vue        â†’ /
  users/
    index.vue      â†’ /users
    [id].vue       â†’ /users/:id
  login/
    index.vue      â†’ /login
```

---

## ç”Ÿæˆã•ã‚Œã‚‹å‹

```ts
// @typed-router ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‹ã‚‰åˆ©ç”¨å¯èƒ½
import { RoutesNamesList, RoutesParamsRecord } from "@typed-router";

// ãƒ«ãƒ¼ãƒˆåã®ãƒ¦ãƒ‹ã‚ªãƒ³å‹
type RoutesNamesList = "index" | "users" | "users-id" | "login";

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹è¾æ›¸
type RoutesParamsRecord = {
  index: never;
  users: never;
  "users-id": { id: string };
  login: never;
};
```

---

## å‹å®‰å…¨ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

```ts
// RoutesNamedLocations - router.push() ã®å‹å®‰å…¨åŒ–
type RoutesNamedLocations =
  | { name: "index" }
  | { name: "users" }
  | { name: "users-id"; params: { id: string } }
  | { name: "login" };

// ãƒ«ãƒ¼ãƒˆåã«å¿œã˜ã¦ params ãŒè‡ªå‹•çš„ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹
router.push({ name: "users-id", params: { id: "123" } }); // âœ“ OK
router.push({ name: "users-id" }); // âœ— ã‚¨ãƒ©ãƒ¼: params ãŒå¿…é ˆ
router.push({ name: "login", params: {} }); // âœ— ã‚¨ãƒ©ãƒ¼: params ä¸è¦
```

---

## å‹ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿

```ts
const route = useRoute();

// route.name ã§åˆ†å²ã™ã‚‹ã¨ params ã®å‹ãŒçµã‚Šè¾¼ã¾ã‚Œã‚‹
if (route.name === "users-id") {
  console.log(route.params.id); // string å‹
}

// ãƒ«ãƒ¼ãƒˆåã‚’æŒ‡å®šã—ã¦ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚‚å¯èƒ½
const route = useRoute("login");
console.log(route.name); // "login" å‹
```

---

## ç”Ÿæˆã•ã‚Œã‚‹ `routesNames`

```ts
const routeName = routesNames.usersId; // "users-id"

// å®Ÿéš›ã«ç”Ÿæˆã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
export const routesNames = {
  index: "index" as const,
  users: "users" as const,
  usersId: "users-id" as const,
  login: "login" as const,
};
```

---

## TypeScript ã®æ©æµ

IDE ã®è£œå®ŒãŒåŠ¹ã
typo ã«æ°—ã¥ã

---

## å¿«é©ãªé–‹ç™ºä½“é¨“

```ts
router.push({ name: "user-id" }); // Error! âŒ
router.push({ name: "user-id", params: { bar: "baz" } }); // Error! âŒ
router.push("/user"); // Error! âŒ

const id = "ey7878";
router.push(`/user/${id}`); // Good! âœ…
router.push({ name: "user-id", params: { id } }); // Good! âœ…

router.push(`/user/${id}/baguette`); // Error! âŒ
```

---

## å¾“æ¥ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å•é¡Œ

```ts
const router = useRouter();

const navigateToUser = (userId) => {
  router.push(`/usr/${userId}`); // âŒ typo: actual "user"
};
```

âš ï¸ typo ã®å±é™ºæ€§

---

## å¾“æ¥ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å•é¡Œ

```ts
// /users/123/posts/456/comments?sort=latest
import { useRoute } from "vue-router";

const route = useRoute();

const currentUserId = route.params.id;
const currentTab = route.query.tab;
```

ğŸ«  ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹ãŒæ›–æ˜§

---

## å¾“æ¥ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å•é¡Œ

ğŸ¥³ < ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç”»é¢ã ã‹ã‚‰ãã£ã¨ `user-detail` ã ã‚ˆã­

ğŸ˜‰ < ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ã ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã‚‚ã¡ã‚ã‚“ `userId` ğŸ‘

```ts
router.push({
  name: "user-detail", // âŒ å®Ÿéš›ã¯ user-id
  params: { userId }, // âŒ å®Ÿéš›ã¯ id
});
```

ğŸ˜­ IDE ã®è£œå®ŒãŒåŠ¹ã‹ãªã„

---
layout: center
class: text-7xl
---

ã“ã†ãªã£ãŸã‚‰å¬‰ã—ã„

---

## ç†æƒ³çš„ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é–‹ç™ºä½“é¨“

- typo ã—ãŸã‚‰ã™ãæ°—ã¥ã
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹ãŒæ˜ç¢º
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå®‰å…¨
- IDE ã®è£œå®ŒãŒåŠ¹ã

---

## Nuxt Typed Router ã«ã‚ˆã‚‹è§£æ±º

---

## typo ã‚’é˜²ã & IDE è£œå®ŒãŒåŠ¹ã

```ts
import { useRouter } from "@typed-router";
const router = useRouter();

// âœ… IDE ãŒè‡ªå‹•è£œå®Œå€™è£œã‚’è¡¨ç¤º
router.push({
  name: "articles-slug", // Tab ã§å€™è£œãŒå‡ºã‚‹
  params: { slug: "hello-world" }, // å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ææ¡ˆ
});

// âŒ typo ã‚„å­˜åœ¨ã—ãªã„ãƒ«ãƒ¼ãƒˆã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
router.push({ name: "usr-id" }); // TypeScript Error!
```

---

## å‹ãŒæ˜ç¢º

```ts
import { useRoute } from "@typed-router";

const route = useRoute();

// æ¡ä»¶åˆ†å²ã§å‹ãŒè‡ªå‹•çš„ã«çµã‚Šè¾¼ã¾ã‚Œã‚‹
if (route.name === "articles-slug") {
  const slug = route.params.slug; // stringå‹ã¨ã—ã¦æ¨è«–
  console.log(slug.length); // âœ… stringãƒ¡ã‚½ãƒƒãƒ‰ãŒè£œå®Œ
}
```

ä½“é¨“ã—ã¦ã¿ã¦ãã ã•ã„âŒ¨ï¸

---

## Nuxt Typed Router ã§ DX å‘ä¸Š

IDE ã®è£œå®ŒãŒåŠ¹ã

- ãƒ«ãƒ¼ãƒˆåã‚„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åãŒè‡ªå‹•è£œå®Œã•ã‚Œã‚‹
- typo ã‚’æœªç„¶ã«é˜²ã

é™çš„è§£æã§ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥

- å­˜åœ¨ã—ãªã„ãƒ«ãƒ¼ãƒˆã¸ã®é·ç§»ã‚’æ¤œå‡º
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚ã®ä¿®æ­£æ¼ã‚Œã‚’é˜²ã

ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ã‚¹ãƒˆæ¸›

- å‹ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£ã—ã•ã‚’ä¿è¨¼
- ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã¯å‹ã‚¨ãƒ©ãƒ¼ã§ã¯ãªããƒ­ã‚¸ãƒƒã‚¯ã«é›†ä¸­ã§ãã‚‹
- (æœ€è¿‘ã¯ AI ãŒãã‚Œã£ã½ã„ã®ã‚’æå‡ºã—ã¦ãã‚‹)

---

## å‹å®‰å…¨ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

---

## `<NuxtLink />` ã‚’ãƒ©ãƒƒãƒ—ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```vue
<script setup lang="ts" generic="T extends RoutesNamesList, P extends string">
import type { RoutesNamesList, NuxtRoute } from "@typed-router";

const { to } = defineProps<{
  to: NuxtRoute<T, P>;
}>();
</script>

<template>
  <NuxtLink :to><slot /></NuxtLink>
</template>
```

```vue
<script setup lang="ts" generic="T extends RoutesNamesList, P extends string">
import type { RoutesNamesList, NuxtRoute } from "@typed-router";

// å¤–éƒ¨ãƒªãƒ³ã‚¯
const { to, external } = defineProps<
  { to: NuxtRoute<T, P>; external?: false } | { to: string; external: true }
>();
</script>

<template>
  <NuxtLink :to :external><slot /></NuxtLink>
</template>
```

ğŸ¤”

---

## Script Setup Generics ã¨ã¯

Vue 3.3+

`<script setup>` ã«ç›´æ¥ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å®šç¾©ã§ãã‚‹

```vue
<script setup lang="ts" generic="T extends SomeType">
// T ã¯å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦åˆ©ç”¨å¯èƒ½
</script>
```

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã§å‹å®‰å…¨ãª props ã‚’å®Ÿç¾

---

## Generics ã«ã‚ˆã‚‹å‹å®‰å…¨ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```vue
<script setup lang="ts" generic="T extends RoutesNamesList, P extends string">
import type { RoutesNamesList, NuxtRoute } from "@typed-router";

const props = defineProps<{
  to: NuxtRoute<T, P>;
}>();
</script>
```

- `T`: ãƒ«ãƒ¼ãƒˆåã®å‹ï¼ˆe.g. `'index' | 'about' | 'articles-slug'`ï¼‰
- `P`: ãƒ‘ã‚¹æ–‡å­—åˆ—ã®å‹
- `NuxtRoute<T, P>`: å‹å®‰å…¨ãªãƒ«ãƒ¼ãƒˆå®šç¾©

---

## Nuxt Typed Router ã®ã“ã“ãŒå¥½ã

---

## Out-of-Box I18n Support

`@nuxtjs/i18n`

`useLocalePath()`, `useLocaleRoute()`, `<NuxtLinkLocale>`

```ts
const localePath = useLocalePath();

// Error âŒ
navigateTo(localePath({ name: "user-id" }, "fr"));

// Good âœ…
navigateTo(localePath({ name: "user-id", params: { id: 1 } }, "fr"));
```

```ts
const localeRoute = useLocaleRoute();

// Error âŒ
const route = localeRoute({ name: "user-id" }, "fr");

// Good âœ…
const route = localeRoute({ name: "user-id", params: { id: 1 } }, "fr"));
if (route) navigateTo(route.fullPath);
```

```vue
<template>
  <NuxtLinkLocale :to="{ name: 'users' }" locale="fr"> />
</template>
```

---
layout: center
class: text-9xl
---

ãˆã€ã¾ã£ã¦

---
layout: center
class: text-6xl
---

Nuxt Typed Pages ã¯ï¼Ÿ

---

## Nuxt Typed Router ã¨ Nuxt Typed Pages ã¯åˆ¥ç‰©

3rd party module VS Official feature

å®‰å®š VS å®Ÿé¨“çš„æ©Ÿèƒ½

---

## Nuxt Typed Router ã¯ 3rd party module

ğŸ¦¾ å®‰å®š

---

## Nuxt Typed Pages ã¯å…¬å¼æ©Ÿèƒ½

ğŸ§ª å®Ÿé¨“çš„æ©Ÿèƒ½

---

## Nuxt Typed Pages

- `unplugin-vue-router` ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸå‹å®‰å…¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- Nuxt Typed Router ã¨åŒæ§˜ã®æ©Ÿèƒ½ã‚’ Nuxt æœ¬ä½“ã§æä¾›

```ts
// nuxt.config.ts
export default defineNuxtConfig({
  experimental: {
    typedPages: true,
  },
});
```

Nuxt 3.5+

---

## unplugin-vue-router

**å‹ä»˜ããƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**

for Vue 3

Nuxt Typed Pages ã®åŸºç›¤æŠ€è¡“

Not Only Nuxt

---

## unplugin-vue-router ã¨ Nuxt Typed Router

![unplugin-vue-router ã¨ Nuxt Typed Router](/uvr-ntr.png)

unplugin-vue-router ã¯ Nuxt Typed Router ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¾—ã¦ä½œã‚‰ã‚Œã¾ã—ãŸ

---

## unplugin-vue-router

![posva GitHub](/posva-github.png)

by posva
Eduardo San Martin Morote

---

## posva's OSS

- Vue Router / unplugin-vue-router
- Pinia / Pinia Colada
- VueFire
- mande
- vue-promised

---
layout: center
class: text-9xl
---

Pinia Colada

---

![piÃ±a colada](/pina-colada.jpg)

---

## piÃ±a colada

ãƒ©ãƒ ã‚’ãƒ™ãƒ¼ã‚¹ã«ãƒ‘ã‚¤ãƒŠãƒƒãƒ—ãƒ«ã‚¸ãƒ¥ãƒ¼ã‚¹ã¨ã‚³ã‚³ãƒŠãƒƒãƒ„ãƒŸãƒ«ã‚¯ã‚’ç •ã„ãŸæ°·ã¨ä¸€ç·’ã«ã‚·ã‚§ã‚¤ã‚¯ã—ã¦ä½œã‚‹ãƒ­ãƒ³ã‚°ãƒ‰ãƒªãƒ³ã‚¯ã€‚é»„ç™½è‰²ã§ç”˜ã¿ãŒå¼·ã„ã€‚

---

![Pinia Colada](/icons/pinia-colada.svg)

---
layout: center
class: text-9xl
---

Pinia Colada

---

## å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

https://pinia-colada.esm.dev/

---

## Pinia Colada ã¨ã¯

Vue ç”¨ã®éåŒæœŸçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

Vue ç”¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

---
layout: center
class: text-9xl
---

ç‰¹å¾´

---

## âš¡ï¸ Automatic Caching

client-side cache
dedupe

---

## ğŸ—„ï¸ Async State

ã‚ã‚‰ã‚†ã‚‹éåŒæœŸçŠ¶æ…‹ã®å‡¦ç†

---

## ğŸ”Œ Plugins

å¼·åŠ›ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

---

## âœ¨ Optimistic Updates

æ¥½è¦³çš„æ›´æ–°ã‚‚ç°¡å˜ã«å®Ÿç¾

---

## ğŸ’¡ Sensible Defaults

å¥å…¨ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
å®Œå…¨ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§

---

## ğŸ§© Out-of-the-Box Plugins

ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ç”¨ã®
composables

---

## ğŸ”‘ TypeScript Support

TypeScript å‹ã‚µãƒãƒ¼ãƒˆ

---

## ğŸ’¨ Small Bundle Size

ç´„ 2kb ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³
fully tree-shakeable

---

## ğŸ“¦ Zero Dependencies

ä¾å­˜é–¢ä¿‚ãªã—(Pinia ä»¥å¤–)

---

## âš™ï¸ SSR

SSR ã‚µãƒãƒ¼ãƒˆ

---

## ğŸ”„ Data Loaders

Vue Router Data Loaders

---

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
ni @pinia/colada
```

â— Pinia ã‚‚å¿…è¦

"peerDependencies": {
"pinia": "^2.2.6 || ^3.0.0",
"vue": "^3.5.17"
}

---

## Vue ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¨­å®š

```ts
import { createApp } from "vue";
import App from "./App.vue";
import { createPinia } from "pinia";
import { PiniaColada } from "@pinia/colada";

const app = createApp(App);
const pinia = createPinia();
app.use(pinia);
app.use(PiniaColada, {
  /** Options */
});
```

---

## ã‚‚ã¡ã‚ã‚“ Nuxt module ã‚‚

```bash
nlx nuxi@latest module add @pinia/colada-nuxt
```

```ts
// nuxt.config.ts
export default defineNuxtConfig({
  modules: ["@pinia/nuxt", "@pinia/colada-nuxt"],
});
```

---

## BEFORE ã¨ AFTER

```ts
// BEFORE ğŸ˜

// çŠ¶æ…‹
const isLoading = ref(false);
const isPending = ref(true);
const error = shallowRef(null);
const data = shallowRef(null);

// ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ
async function refresh() {
  isLoading.value = true; // æ‰‹å‹•æ›´æ–°
  try {
    data.value = await fetchUsers();
    error.value = null; // æ‰‹å‹•æ›´æ–°
    isPending.value = false; // æ‰‹å‹•æ›´æ–°
  } catch (err) {
    error.value = err; // æ‰‹å‹•æ›´æ–°
  } finally {
    isLoading.value = false; // æ‰‹å‹•æ›´æ–°
  }
}

refresh(); // æ‰‹å‹•ã®åˆå›ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ
```

```ts
// AFTER â˜ºï¸

const { data, error, isPending, isLoading, refresh } = useQuery({
  key: ["users"],
  query: () => fetchUsers(),
});
```

ğŸ¹ ã™ã£ãã‚Š
ğŸ çŠ¶æ…‹ç®¡ç†
ğŸ–ï¸ å†åˆ©ç”¨æ€§

---

## ã„ã„æ„Ÿã˜ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ

- **å®£è¨€çš„**ã«è¨˜è¿°
- ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆãªã—
- ã„ã„æ„Ÿã˜ã«**ã‚­ãƒ£ãƒƒã‚·ãƒ¥**
- **å‹**

---
layout: center
class: text-6xl
---

Pinia Colada ã«ã‚ˆã‚‹è§£æ±º

---
layout: center
class: text-9xl
---

ãã®å‰ã«

---
layout: center
class: text-7xl
---

ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã®

---
layout: center
class: text-8xl
---

è€ƒãˆæ–¹ã‚„ç”¨èªã‚’

---

## Query ã¨ Mutation

ğŸ” Query
ãƒ‡ãƒ¼ã‚¿ã‚’**èª­ã¿å–ã‚‹**

âœï¸ Mutation
ãƒ‡ãƒ¼ã‚¿ã‚’**æ›¸ãè¾¼ã‚€**

---

## ğŸ’¾ Cache

å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦å†åˆ©ç”¨

åŒã˜ãƒ‡ãƒ¼ã‚¿ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‰Šæ¸›
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¿œç­”æ€§ãŒå‘ä¸Š

---

## ğŸŒ Active Query

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½¿ç”¨ä¸­ã®ã‚¯ã‚¨ãƒª

ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿
è‡ªå‹•çš„ã«æ›´æ–°ãƒ»ç®¡ç†ã•ã‚Œã‚‹

---

## ğŸ’¤ Inactive Query

ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‚¯ã‚¨ãƒª

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¯æ®‹ã£ã¦ã„ã‚‹ãŒéè¡¨ç¤º
ä¸€å®šæ™‚é–“å¾Œã«ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

---

## ğŸ£ Stale / Fresh

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã®é®®åº¦ç®¡ç†

ãƒ‡ãƒ¼ã‚¿ã®æ–°é®®ã•ã‚’åˆ¤æ–­ã™ã‚‹åŸºæº–
é®®åº¦ã«å¿œã˜ã¦è‡ªå‹•çš„ã«å†å–å¾—

---

## ğŸ”„ Invalidation

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ˜ç¤ºçš„ã«ç„¡åŠ¹åŒ–

ãƒ‡ãƒ¼ã‚¿æ›´æ–°å¾Œã«é–¢é€£ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–
æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ã¦è¡¨ç¤º

---

## Pinia Colada ã«ã‚ˆã‚‹è§£æ±º

æ”¹ã‚ã¦ğŸ¹

---

## å®£è¨€çš„

```ts
// ã€Œä½•ã‚’ãƒ•ã‚§ãƒƒãƒã™ã‚‹ã‹ã€ã ã‘ã‚’è¨˜è¿°
const { data, error, status } = useQuery({
  key: ["todos"],
  query: () => $fetch("/api/todos"),
});

// âœ… loading, error, data ã®çŠ¶æ…‹ç®¡ç†ã¯è‡ªå‹•
// âœ… åˆå›ãƒ•ã‚§ãƒƒãƒã‚‚è‡ªå‹•
// âœ… cache, dedupe ã‚‚è‡ªå‹•
```

query é–¢æ•°ã¯å¼•æ•°ã‚’å–ã‚‰ãªã„

Pinia Colada ãŒ
ã€Œå¿…è¦ãªã¨ãã«è‡ªå‹•çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã€

é–‹ç™ºè€…ã¯ã€Œä½•ã‚’ã€ãƒ•ã‚§ãƒƒãƒã™ã‚‹ã‹ã ã‘ã‚’å®£è¨€
ã€Œã„ã¤ã€ãƒ•ã‚§ãƒƒãƒã™ã‚‹ã‹ã¯ Pinia Colada ãŒåˆ¤æ–­

---

## å‹

```ts
const { data } = useQuery({
  key: ["users"],
  query: () => $fetch("/api/users"),
});

// ShallowRef<SerializeObject<User>[] | undefined>
console.log(data);
```

---

## `useQuery()`

```vue
<script setup lang="ts">
const { state, asyncStatus, refresh } = useQuery({
  key: () => ["users"],
  query: () => $fetch("/api/users"),
});
</script>

<template>
  <p v-if="asyncStatus === 'loading'">èª­ã¿è¾¼ã¿ä¸­...</p>
  <p v-else-if="state.status === 'error'" role="alert">
    ã‚¨ãƒ©ãƒ¼: {{ state.error.message }}
  </p>
  <section v-else-if="state.status === 'success'">
    <p>{{ state.data.name }}</p>
    <button @click="refresh">æ›´æ–°</button>
  </section>
</template>
```

query ã¯å¼•æ•°ã‚’å–ã‚‰ãªã„
å®£è¨€çš„ã«è¨˜è¿°ã§ãã‚‹

---

## `useMutation()`

```vue
<script setup lang="ts">
const { mutate: createTodo, status } = useMutation({
  mutation: (newTodo: { title: string }) => {
    $fetch("/api/todos", { method: "POST", body: newTodo });
  },
});
</script>

<template>
  <button
    @click="createTodo({ title: 'æ–°ã—ã„ã‚¿ã‚¹ã‚¯' })"
    :disabled="status === 'pending'"
  >
    {{ status === "pending" ? "ä½œæˆä¸­..." : "ã‚¿ã‚¹ã‚¯ä½œæˆ" }}
  </button>
</template>
```

mutate ã¯å¼•æ•°ã‚’å–ã‚‹

---

## Query ã¨ Mutation ã®é€£æº

Mutation ã§ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´âœ¨

Query ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–ğŸ·ï¸

---

## Pinia ã‚’ Cache ã«ä½¿ç”¨

å†…éƒ¨ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã«
Pinia ã‚¹ãƒˆã‚¢ã‚’ä½¿ç”¨

---

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆã‚¢ã®æ§‹é€ 

![DevTools - _pc_query](/devtools-pc-query.png)

\_pc_query

---

## Query Invalidation

```ts
const queryCache = useQueryCache();

const { state } = useQuery({ key: ["todos"], query: () => $("/api/todos") });

const { mutate } = useMutation({
  mutation: (text: string) =>
    $fetch("/api/todos", {
      method: "POST",
      body: { text },
    }),
  onSettled: () => {
    queryCache.invalidateQueries({ key: ["todos"] });
  },
});
```

query cache ã®ç„¡åŠ¹åŒ–(onSettled)
æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

---

## Hooks

Mutation ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

---

## Mutation Hooks

- `onMutate` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ç›´å‰
- `onSuccess` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆæˆåŠŸæ™‚
- `onError` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¤±æ•—æ™‚
- `onSettled` - æˆåŠŸãƒ»å¤±æ•—ã«é–¢ã‚ã‚‰ãšå®Ÿè¡Œ

---

## Hooks ã§å®Ÿç¾ã§ãã‚‹ã“ã¨

- ã‚¯ã‚¨ãƒªã®ç„¡åŠ¹åŒ–
- æ¥½è¦³çš„æ›´æ–°ï¼ˆOptimistic Updatesï¼‰
- ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å—ã‘æ¸¡ã—

---

## Query Invalidation

```ts
// key: ["todos"] ã‚’æŒ‡å®šã™ã‚‹ã¨
// ãã® key ã¨ãã®å­ã®ã‚¯ã‚¨ãƒªãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹

// exact: true ã‚’ä»˜ã‘ã‚‹ã¨
// æŒ‡å®šã—ãŸ key ã®ã‚¯ã‚¨ãƒªã ã‘ç„¡åŠ¹åŒ–ã•ã‚Œã‚‹

// å¼•æ•°ãªã—ã§å‘¼ã¶ã¨
// ã™ã¹ã¦ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¯ã‚¨ãƒªãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹
```

ãƒ‡ãƒ¼ã‚¿æ›´æ–°å¾Œã€é–¢é€£ã™ã‚‹ã‚¯ã‚¨ãƒªã‚’ç„¡åŠ¹åŒ–

---

## `useQuery()` ã® 2 ã¤ã®é‡è¦ãªã“ã¨

```ts
const { state, asyncStatus } = useQuery({
  key: ["todos"],
  query: () => $fetch("/api/todos"),
});
```

- `key`: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è­˜åˆ¥å­(é…åˆ—ã«ã‚ˆã‚‹éšå±¤æ§‹é€ )
- `query`: Promise ã‚’è¿”ã™é–¢æ•°

---

## Query Key ã®è¨­è¨ˆãŒé‡è¦

- **é…åˆ—å½¢å¼**ã§æ§‹é€ åŒ–ã•ã‚ŒãŸã‚­ãƒ¼
- **éšå±¤çš„ãªè¨­è¨ˆ**ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æŸ”è»Ÿã«ç®¡ç†
- **ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãª key** ã¯é–¢æ•°ã§å®šç¾©

```ts
// é™çš„ãª key
key: ["products"];

// å‹•çš„ãª key(é–¢æ•°å½¢å¼)
key: () => ["products", route.params.id];
key: () => ["products", route.params.id, { searchResult: true }];
```

---

## Query, Mutate, Invalidate

```ts
const queryCache = useQueryCache();

// Todo ãƒªã‚¹ãƒˆã® Query
const { data: todos } = useQuery({
  key: ["todos"],
  query: () => $fetch("/api/todos"),
});

// Todo ä½œæˆã® Mutation
const { mutate: createTodo } = useMutation({
  mutation: (text: string) =>
    $fetch("/api/todos", {
      method: "POST",
      body: { text },
    }),
  onSettled: () => {
    // ä½œæˆå¾Œã« todos ãƒªã‚¹ãƒˆã‚’ç„¡åŠ¹åŒ–ã—ã¦æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    queryCache.invalidateQueries({ key: ["todos"] });
  },
});
```

---

## Query Keys ã®é‡è¦æ€§

Query Keys ã¯ã‚¯ã‚¨ãƒªã‚’
ä¸€æ„ã«è­˜åˆ¥ã™ã‚‹ãŸã‚ã®**é…åˆ—**

---

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã®åŸºç›¤

åŒã˜ key ã‚’æŒã¤ã‚¯ã‚¨ãƒªã¯åŒã˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å…±æœ‰

key ãŒç•°ãªã‚Œã°åˆ¥ã€…ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹

---

## éšå±¤çš„ãªæ§‹é€ 

`["todos"], ["todos", id], ...`

è¦ª key ã§å­ã‚‚å«ã‚ã¦ä¸€æ‹¬ç„¡åŠ¹åŒ–ãŒå¯èƒ½

---

## é©åˆ‡ãªç„¡åŠ¹åŒ–

Mutation å¾Œã«é–¢é€£ã™ã‚‹ã‚¯ã‚¨ãƒªã‚’åŠ¹ç‡çš„ã«æ›´æ–°

éƒ¨åˆ†çš„ãªç„¡åŠ¹åŒ–ã§å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã ã‘å†å–å¾—

---

## Key è¨­è¨ˆã®ä¾‹

```ts
// åŸºæœ¬: å˜ç´”ãªãƒªã‚¹ãƒˆå–å¾—
const { data } = useQuery({
  key: ["todos"],
  query: () => $fetch("/api/todos"),
});

// éšå±¤: ID ã‚’å«ã‚€ã‚¯ã‚¨ãƒª
const { data } = useQuery({
  key: () => ["todos", todoId],
  query: () => $fetch(`/api/todos/${todoId}`),
});

// ["todos"] ã§ç„¡åŠ¹åŒ–ã™ã‚‹ã¨ã€
// ã™ã¹ã¦ã® todos é–¢é€£ã®ã‚¯ã‚¨ãƒªãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹

// éšå±¤: ã•ã‚‰ã«è©³ç´°ãªæ¡ä»¶
const { data } = useQuery({
  key: () => ["todos", todoId, { withComments: true }],
  query: () => $fetch(`/api/todos/${todoId}?comments=true`),
});

// ["todos"] ã§ç„¡åŠ¹åŒ– â†’ ã™ã¹ã¦ã® todos
// ["todos", todoId] ã§ç„¡åŠ¹åŒ– â†’ ç‰¹å®šã® todo ã ã‘
// ["todos", todoId, {}] ã§ç„¡åŠ¹åŒ– â†’ ç‰¹å®šã® todo ã®ã™ã¹ã¦ã®æ¡ä»¶
```

---

## å‹å®‰å…¨ãªã‚­ãƒ¼è¨­è¨ˆ

```ts
// Before: æ–‡å­—åˆ—ã‚­ãƒ¼ã®å•é¡Œ
const { data } = useQuery({
  key: () => ["users", userId], // typo ã®å¯èƒ½æ€§
  query: () => fetchUser(userId),
});

// åˆ¥ã®å ´æ‰€ã§åŒã˜ã‚­ãƒ¼ã‚’ä½¿ãŠã†ã¨ã™ã‚‹ã¨...
cache.invalidateQueries({ key: ["user", userId] }); // âŒ typo

// After: defineQueryOptions ã§å‹å®‰å…¨ã«
const userQuery = defineQueryOptions((id: string) => ({
  key: ["users", id],
  query: () => fetchUser(id),
}));

// ä½¿ç”¨æ™‚ã¯å‹ä»˜ãã®ã‚­ãƒ¼ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
const { data } = useQuery(userQuery(userId));

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ“ä½œã‚‚å‹å®‰å…¨
cache.invalidateQueries(userQuery(userId));
```

---
layout: center
class: text-9xl
---

key è¨­è¨ˆ

---
layout: center
class: text-9xl
---

ã£ã¦

---
layout: center
class: text-9xl
---

ã¾ãŸæ–‡å­—åˆ—ï¼Ÿ

---

## Key Factory ãƒ‘ã‚¿ãƒ¼ãƒ³

Query Key ã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹
å‹å®‰å…¨ãªãƒ‘ã‚¿ãƒ¼ãƒ³

---

## Key Factory ã®å®Ÿè£…ä¾‹

```ts
export const TODO_KEYS = {
  root: ["todos"] as const,
  withFilters: (filters?: TodoFilters) => [...TODO_KEYS.root, filters] as const,
  byId: (id: string) => [...TODO_KEYS.root, id] as const,
  comments: (id: string) => [...TODO_KEYS.byId(id), "comments"] as const,
};
```

---

## Key Factory ã®ä½¿ç”¨ä¾‹

```ts
// Before: æ–‡å­—åˆ—ãƒ™ãƒ¼ã‚¹
const { data } = useQuery({
  key: ["todos"], // typo ã®å¯èƒ½æ€§
  query: () => fetchTodos(),
});

// After: Key Factory
import { TODO_KEYS } from "~/queries/key-factory";

const { data } = useQuery({
  key: TODO_KEYS.root, // å‹å®‰å…¨ï¼
  query: () => fetchTodos(),
});

// ç„¡åŠ¹åŒ–ã‚‚ç°¡å˜
const queryCache = useQueryCache();

// ã™ã¹ã¦ã® todos ã‚’ç„¡åŠ¹åŒ–
queryCache.invalidateQueries({ key: TODO_KEYS.root });

// ç‰¹å®šã® todo ã ã‘ç„¡åŠ¹åŒ–
queryCache.invalidateQueries({ key: TODO_KEYS.byId(todoId) });
```

---
layout: center
class: text-7xl
---

query ã®è¨­å®šã‚‚å…±æœ‰

---

## defineQueryOptions

```ts
import { defineQueryOptions } from "@pinia/colada";

export const todoListQuery = defineQueryOptions(() => ({
  key: ["todos"],
  query: () => $fetch("/api/todos"),
}));

export const todoByIdQuery = defineQueryOptions((id: string) => ({
  key: ["todos", id],
  query: () => $fetch(`/api/todos/${id}`),
}));
```

---

## defineQueryOptions ã®ä½¿ç”¨ä¾‹

```ts
// Before: æ¯å› key ã¨ query ã‚’æ›¸ã
const { state } = useQuery({
  key: ["todos", todoId],
  query: () => $fetch(`/api/todos/${todoId}`),
});

// Cache ã«æ‰‹å‹•ã§å‹ã‚’æŒ‡å®š
const queryCache = useQueryCache();
const todo = queryCache.getQueryData<Todo>(["todos", todoId]);

// After: å†åˆ©ç”¨å¯èƒ½ãªå®šç¾©
import { todoByIdQuery } from "~/queries/todos";

const { state } = useQuery(todoByIdQuery, todoId);

// Cache ã®å‹ãŒæ¨è«–ã•ã‚Œã‚‹
const queryCache = useQueryCache();
const todo = queryCache.getQueryData(todoByIdQuery(todoId).key);
```

---

## Key Factory Ã— defineQueryOptions

```ts
import { defineQueryOptions } from "@pinia/colada";

export const TODO_KEYS = {
  root: ["todos"] as const,
  byId: (id: string) => [...TODO_KEYS.root, id] as const,
};

export const todoByIdQuery = defineQueryOptions((id: string) => ({
  key: TODO_KEYS.byId(id),
  query: () => $fetch(`/api/todos/${id}`),
}));
```

---

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ã«å¿œã˜ãŸ
3 ã¤ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

---

## â‘  ç›´æ›¸ãï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ï¼‰

```vue
<!-- pages/teams/[id].vue -->
<script setup lang="ts">
const route = useRoute();

const team = useQuery({
  key: () => ["teams", route.params.id],
  query: () => $fetch(`/api/teams/${route.params.id}`),
});

const members = useQuery({
  key: () => ["teams", route.params.id, "users"],
  query: () => $fetch(`/api/teams/${route.params.id}/users`),
});
</script>
```

**ç‰¹å¾´**: æœ€å°‘ã‚³ãƒ¼ãƒ‰ã ãŒã€ã‚­ãƒ¼ãƒ»å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ãŒç”»é¢ã«åˆ†æ•£ã—ã‚„ã™ã„

---

## â‘¡ Key Factory å˜ç‹¬

```ts
// queries/key-factory.ts
export const TEAM_KEYS = {
  root: ["teams"] as const,
  byId: (id: string) => [...TEAM_KEYS.root, id] as const,
  users: (id: string) => [...TEAM_KEYS.byId(id), "users"] as const,
};
```

---

```vue
<!-- pages/teams/[id].vue -->
<script setup lang="ts">
import { TEAM_KEYS } from "~/queries/key-factory";

const route = useRoute();

const team = useQuery({
  key: () => TEAM_KEYS.byId(route.params.id),
  query: () => $fetch(`/api/teams/${route.params.id}`),
});

const members = useQuery({
  key: () => TEAM_KEYS.users(route.params.id),
  query: () => $fetch(`/api/teams/${route.params.id}/users`),
});
</script>
```

**ç‰¹å¾´**: ã‚­ãƒ¼å½¢çŠ¶ã‚’ä¸€å…ƒåŒ–ã§ãã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ•´åˆæ€§ãŒå‘ä¸Šã€‚å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã¯ç”»é¢ã«æ®‹ã‚‹

---

## â‘¢ Key Factory Ã— defineQueryOptions

```ts
// queries/key-factory.ts
export const TEAM_KEYS = {
  root: ["teams"] as const,
  byId: (id: string) => [...TEAM_KEYS.root, id] as const,
  users: (id: string) => [...TEAM_KEYS.byId(id), "users"] as const,
};

// queries/team.ts
import { defineQueryOptions } from "@pinia/colada";
import { TEAM_KEYS } from "./key-factory";

export const teamByIdQuery = defineQueryOptions((teamId: string) => ({
  key: TEAM_KEYS.byId(teamId),
  query: () => $fetch(`/api/teams/${teamId}`),
}));

export const teamUsersQuery = defineQueryOptions((teamId: string) => ({
  key: TEAM_KEYS.users(teamId),
  query: () => $fetch(`/api/teams/${teamId}/users`),
}));
```

---

```vue
<!-- pages/teams/[id].vue -->
<script setup lang="ts">
import { teamByIdQuery, teamUsersQuery } from "~/queries/team";

const route = useRoute();

const team = useQuery(teamByIdQuery, route.params.id);
const members = useQuery(teamUsersQuery, route.params.id);
</script>
```

**ç‰¹å¾´**: ã‚­ãƒ¼æ•´åˆæ€§ï¼ˆFactoryï¼‰ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¥‘ç´„ãƒ»å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆdefineQueryOptionsï¼‰ã‚’é›†ç´„

---

## 3ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¯”è¼ƒ

| æ§‹æˆ                                 | ã‚­ãƒ¼æ•´åˆæ€§ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å…±æœ‰ | å¤‰æ›´è€æ€§ | è¦æ¨¡   |
| :----------------------------------- | :--------- | :------------- | :------- | :----- |
| ç›´æ›¸ã                               | ä½         | ä½             | ä½       | å°     |
| Key Factory å˜ç‹¬                     | ä¸­         | ä¸­             | ä¸­       | ä¸­     |
| **Key Factory Ã— defineQueryOptions** | **é«˜**     | **é«˜**         | **é«˜**   | **å¤§** |

Scalable & Progressive

æ°—è»½ã«ã‚‚æ›¸ã‘ã‚‹ã—
ã‚¬ãƒã‚¬ãƒã«ã‚‚æ›¸ã‘ã‚‹

---

## Pinia Colada ã‚’ä½¿ç”¨ã™ã‚‹ã¨

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆãªã
ã‚¯ã‚¨ãƒªã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’
è¿‘ãã«ã‹ã‘ã‚‹

---
layout: center
class: text-7xl
---

ã˜ã‚ƒã‚ã©ã†ã‚„ã£ã¦æ±ºã‚ã‚‹ã‹

---

## å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚ã‚‹

"As your project grows" and you start using more and more queries as well as concepts as Optimistic Updates, you will want to organize your queries.

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæˆé•·ã—ãŸã‚‰æ•´ç†ã—ã‚ˆã†

https://pinia-colada.esm.dev/guide/queries.html#Organizing-Queries

---

## defineQueryOptions ã§ prefetch

```ts
// ã‚¯ã‚¨ãƒªå®šç¾©ã‚’å†åˆ©ç”¨å¯èƒ½ã«
const userListQuery = defineQueryOptions({
  key: ["users"],
  query: () => $fetch("/api/users"),
});

// use
const { data, status } = useQuery(userListQuery);

// prefetch (`cache.ensure()`)
const queryCache = useQueryCache();
await queryCache.refresh(queryCache.ensure(userListQuery));
```

---
layout: center
class: text-6xl
---

Pinia Colada ã§ DX å‘ä¸Š

---

## Pinia Colada ã®ã“ã“ãŒå¥½ã

ã„ã„æ„Ÿã˜ã«ã‚¯ã‚¨ãƒªã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿‘ãã«æ›¸ã‘ã‚‹

---
layout: center
class: text-9xl
---

â‰ï¸

---
layout: center
---

![posva å¤©æ‰](/genius-posva.png)

---

## Nuxt Typed Router + Pinia Colada

å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®å®Œæˆ

---

## IDE ã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªçµ±åˆ

ãƒ«ãƒ¼ãƒˆåã®è‡ªå‹•è£œå®Œ + ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ã®æ¨è«–

ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚ã®å®‰å…¨æ€§

AI æ™‚ä»£

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®èª²é¡Œ

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ

---
layout: center
class: text-5xl
---

ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒ¼ãƒ‰ã§ã®ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ

---
layout: center
class: text-5xl
---

ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰ãƒ•ã‚§ãƒƒãƒï¼šä¾å­˜ã‚¯ã‚¨ãƒª

---
layout: center
class: text-3xl
---

ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰ãƒ•ã‚§ãƒƒãƒï¼šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒã‚¹ãƒˆ

---

## unplugin-vue-router ã® Data Loaders

æ¬¡ä¸–ä»£ã®
ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°æ‰‹æ³•

---
layout: center
class: text-5xl
---

unplugin-vue-router ã® Data Loaders

---

![posva's last year vue fes japan](/posva-last-year.png)

---

https://youtu.be/lhjS-6FIxgk

---
layout: center
class: text-7xl
---

ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ
